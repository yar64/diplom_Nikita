// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL") 
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  firstName String?
  lastName  String?
  avatar    String?
  bio       String?
  timezone  String?  @default("UTC")
  dailyGoal Int?     @default(30)
  isPublic  Boolean  @default(false)
  role      UserRole @default(USER)

  // Relations
  skills               UserSkill[]
  projects             Project[]
  learningPaths        LearningPath[]
  sessions             StudySession[]
  goals                Goal[]
  stats                UserStats?
  givenReviews         Review[]          @relation("GivenReviews")
  receivedReviews      Review[]          @relation("ReceivedReviews")
  notifications        Notification[]
  communityMemberships CommunityMember[]
  communityPosts       CommunityPost[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Skill {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  category    String
  icon        String?
  difficulty  Difficulty @default(BEGINNER)

  // Relations
  userSkills        UserSkill[]
  projectSkills     ProjectSkill[]
  learningResources LearningResource[]
  milestones        LearningMilestone[]
  goals             Goal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("skills")
}

model UserSkill {
  id         String      @id @default(cuid())
  userId     String
  skillId    String
  level      SkillLevel  @default(NOVICE)
  experience Int         @default(0)
  isLearning Boolean     @default(true)
  goalLevel  SkillLevel?
  goalDate   DateTime?
  progress   Float       @default(0)

  // Relations
  user     User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  skill    Skill          @relation(fields: [skillId], references: [id], onDelete: Cascade)
  sessions StudySession[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, skillId])
  @@map("user_skills")
}

model Project {
  id          String        @id @default(cuid())
  title       String
  description String?
  repository  String?
  demoUrl     String?
  status      ProjectStatus @default(IN_PROGRESS)
  userId      String

  // Relations
  user   User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  skills ProjectSkill[]

  startDate DateTime?
  endDate   DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("projects")
}

model ProjectSkill {
  id        String @id @default(cuid())
  projectId String
  skillId   String

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  skill   Skill   @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([projectId, skillId])
  @@map("project_skills")
}

model LearningPath {
  id          String  @id @default(cuid())
  title       String
  description String?
  isPublic    Boolean @default(false)
  userId      String

  // Relations
  user       User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  milestones LearningMilestone[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("learning_paths")
}

model LearningMilestone {
  id             String    @id @default(cuid())
  title          String
  description    String?
  order          Int
  isCompleted    Boolean   @default(false)
  completedAt    DateTime?
  learningPathId String
  skillId        String

  // Relations
  learningPath LearningPath @relation(fields: [learningPathId], references: [id], onDelete: Cascade)
  skill        Skill        @relation(fields: [skillId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("learning_milestones")
}

model StudySession {
  id          String      @id @default(cuid())
  duration    Int
  description String?
  date        DateTime    @default(now())
  sessionType SessionType @default(PRACTICE)
  efficiency  Int?
  userId      String
  userSkillId String

  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userSkill UserSkill @relation(fields: [userSkillId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("study_sessions")
}

model Goal {
  id          String    @id @default(cuid())
  title       String
  description String?
  targetDate  DateTime
  isCompleted Boolean   @default(false)
  completedAt DateTime?
  userId      String
  skillId     String

  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  skill Skill @relation(fields: [skillId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("goals")
}

model LearningResource {
  id          String       @id @default(cuid())
  title       String
  description String?
  url         String
  type        ResourceType
  difficulty  Difficulty
  duration    Int?
  rating      Float?
  skillId     String

  // Relations
  skill Skill @relation(fields: [skillId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("learning_resources")
}

model Review {
  id         String @id @default(cuid())
  title      String
  content    String
  rating     Int
  reviewerId String
  revieweeId String

  // Relations
  reviewer User @relation("GivenReviews", fields: [reviewerId], references: [id], onDelete: Cascade)
  reviewee User @relation("ReceivedReviews", fields: [revieweeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("reviews")
}

model Notification {
  id      String           @id @default(cuid())
  title   String
  message String
  type    NotificationType
  isRead  Boolean          @default(false)
  userId  String

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@map("notifications")
}

model UserStats {
  id              String @id @default(cuid())
  userId          String @unique
  totalStudyTime  Int    @default(0)
  completedGoals  Int    @default(0)
  skillsLearned   Int    @default(0)
  currentStreak   Int    @default(0)
  longestStreak   Int    @default(0)
  weeklyProgress  Float  @default(0)
  monthlyProgress Float  @default(0)

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  updatedAt DateTime @updatedAt

  @@map("user_stats")
}

model Community {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?
  isPublic    Boolean @default(true)
  avatar      String?

  // Relations
  members CommunityMember[]
  posts   CommunityPost[]

  createdAt DateTime @default(now())

  @@map("communities")
}

model CommunityMember {
  id          String        @id @default(cuid())
  communityId String
  userId      String
  role        CommunityRole @default(MEMBER)

  // Relations
  community Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([communityId, userId])
  @@map("community_members")
}

model CommunityPost {
  id          String @id @default(cuid())
  title       String
  content     String
  communityId String
  authorId    String

  // Relations
  community Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  author    User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("community_posts")
}

// Enums
enum UserRole {
  USER
  ADMIN
  MENTOR
}

enum Difficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum SkillLevel {
  NOVICE
  BEGINNER
  COMPETENT
  PROFICIENT
  EXPERT
}

enum ProjectStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum SessionType {
  THEORY
  PRACTICE
  PROJECT
  REVIEW
  EXAM
}

enum ResourceType {
  ARTICLE
  VIDEO
  COURSE
  DOCUMENTATION
  BOOK
  TUTORIAL
  EXERCISE
}

enum NotificationType {
  GOAL_REMINDER
  MILESTONE_ACHIEVED
  NEW_SKILL_SUGGESTION
  WEEKLY_PROGRESS
  COMMUNITY_INVITE
  MENTOR_FEEDBACK
  GOAL_COMPLETED
  STREAK_REMINDER
}

enum CommunityRole {
  MEMBER
  MODERATOR
  ADMIN
}
